/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var $=(u,e)=>{for(var t in e)L(u,t,{get:e[t],enumerable:!0})},R=(u,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of N(e))!G.call(u,i)&&i!==t&&L(u,i,{get:()=>e[i],enumerable:!(n=M(e,i))||n.enumerable});return u};var _=u=>R(L({},"__esModule",{value:!0}),u);var B={};$(B,{default:()=>b});module.exports=_(B);var y=require("obsidian");var O={clientId:"",accessToken:"",tokenExpiry:"unlimited",tokenExpiryDate:void 0,timeRange:90},I={"1week":"1 week","1month":"1 month","3months":"3 months","6months":"6 months",unlimited:"Unlimited (until manually disconnected)"},w="https://rajeevrajchal.github.io/pmc-google/oauth-callback";var C=require("obsidian");var f=class{static initiateOAuthFlow(e){if(!e||e.trim()===""){new C.Notice("Please configure client ID first");return}let t=this.buildAuthUrl(e);new C.Notice("Opening Google authentication..."),window.open(t,"_blank")}static buildAuthUrl(e){let t=new URLSearchParams({client_id:e,redirect_uri:w,response_type:"token",scope:this.SCOPES.join(" "),access_type:"online"});return`${this.OAUTH_URL}?${t.toString()}`}static disconnect(){new C.Notice("Disconnected from Google Calendar")}};f.OAUTH_URL="https://accounts.google.com/o/oauth2/v2/auth",f.SCOPES=["https://www.googleapis.com/auth/calendar.readonly","https://www.googleapis.com/auth/calendar.events"];var c=require("obsidian");var l=class{static calculateExpiryDate(e){if(e==="unlimited")return;let t=Date.now(),n=24*60*60*1e3;switch(e){case"1week":return t+7*n;case"1month":return t+30*n;case"3months":return t+90*n;case"6months":return t+180*n;default:return}}static isTokenExpired(e){return e?Date.now()>=e:!1}static getTimeRemaining(e){if(!e)return"Unlimited";let t=e-Date.now();if(t<=0)return"Expired";let n=Math.floor(t/(24*60*60*1e3)),i=Math.floor(t%(24*60*60*1e3)/(60*60*1e3)),s=Math.floor(t%(60*60*1e3)/(60*1e3));return n>0?`${n} day${n!==1?"s":""}`:i>0?`${i} hour${i!==1?"s":""}`:`${s} minute${s!==1?"s":""}`}static needsRefreshSoon(e){if(!e)return!1;let t=24*60*60*1e3,n=e-Date.now();return n>0&&n<t}static formatExpiryDate(e){return e?new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}};var m=class{static async fetchEvents(e,t="primary",n,i,s,a=250,r){try{if(l.isTokenExpired(r))throw new c.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");let o={singleEvents:"true",orderBy:"startTime",maxResults:a.toString()};i&&(o.timeMin=i),s&&(o.timeMax=s),n&&n.trim()!==""&&(o.q=n);let g=new URLSearchParams(o).toString();return(await(0,c.requestUrl)({url:`${this.BASE_URL}/calendars/${t}/events?${g}`,method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json.items||[]}catch(o){throw console.error("Error fetching calendar events:",o),new c.Notice("Failed to fetch calendar events"),o}}static async createEvent(e,t,n="primary",i){try{if(l.isTokenExpired(i))throw new c.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");let a=(await(0,c.requestUrl)({url:`${this.BASE_URL}/calendars/${n}/events`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)})).json;return new c.Notice("Event created successfully"),a}catch(s){throw console.error("Error creating calendar event:",s),new c.Notice("Failed to create calendar event"),s}}static async updateEvent(e,t,n,i="primary",s){try{if(l.isTokenExpired(s))throw new c.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");let r=(await(0,c.requestUrl)({url:`${this.BASE_URL}/calendars/${i}/events/${t}`,method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(n)})).json;return new c.Notice("Event updated successfully"),r}catch(a){throw console.error("Error updating calendar event:",a),new c.Notice("Failed to update calendar event"),a}}static async deleteEvent(e,t,n="primary",i){try{if(l.isTokenExpired(i))throw new c.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");await(0,c.requestUrl)({url:`${this.BASE_URL}/calendars/${n}/events/${t}`,method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),new c.Notice("Event deleted successfully")}catch(s){throw console.error("Error deleting calendar event:",s),new c.Notice("Failed to delete calendar event"),s}}static async listCalendars(e,t){try{if(l.isTokenExpired(t))throw new c.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");return(await(0,c.requestUrl)({url:`${this.BASE_URL}/users/me/calendarList`,method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json.items||[]}catch(n){throw console.error("Error fetching calendars:",n),new c.Notice("Failed to fetch calendars"),n}}static async syncCalendar(e,t){try{if(l.isTokenExpired(t))throw new c.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");new c.Notice("Syncing calendar...");let n=new Date().toISOString(),i=new Date(Date.now()+30*24*60*60*1e3).toISOString(),s=await this.fetchEvents(e,"primary",void 0,n,i);new c.Notice(`Synced ${s.length} events`);return}catch(n){throw console.error("Error syncing calendar:",n),new c.Notice("Failed to sync calendar"),n}}};m.BASE_URL="https://www.googleapis.com/calendar/v3";var E=require("obsidian");var h=class{static renderSetupGuide(e){let t=e.createDiv({cls:"pmc-setup-guide"});new E.Setting(t).setName("Setup guide").setHeading();let n=t.createEl("ol"),i=n.createEl("li");i.createEl("strong",{text:"Create a google cloud project:"});let s=i.createEl("ul"),a=s.createEl("li");a.appendText("Go to "),a.createEl("a",{text:"Google Cloud Console",href:"https://console.cloud.google.com/",attr:{target:"_blank"}}),s.createEl("li",{text:'Click "Select a project" \u2192 "New project"'}),s.createEl("li",{text:'Give it a name (e.g., "Obsidian PMC plugin") and click "Create"'});let r=n.createEl("li");r.createEl("strong",{text:"Enable Google Calendar API:"});let o=r.createEl("ul");o.createEl("li",{text:'In the sidebar, go to "APIs & services" \u2192 "Library"'}),o.createEl("li",{text:'Search for "Google Calendar API"'}),o.createEl("li",{text:'Click on it and press "Enable"'});let g=n.createEl("li");g.createEl("strong",{text:"Create OAuth 2.0 credentials:"});let p=g.createEl("ul");p.createEl("li",{text:'Go to "APIs & services" \u2192 "Credentials"'}),p.createEl("li",{text:'Click "Create credentials" \u2192 "OAuth client ID"'}),p.createEl("li",{text:"If prompted, configure the OAuth consent screen first"}),p.createEl("li",{text:'Select "Web application" as the application type'}),p.createEl("li",{text:"Add this authorized redirect URI: "}).createEl("code",{text:w}),p.createEl("li",{text:'Click "Create" and copy your client ID'}),n.createEl("li").createEl("strong",{text:"Paste the client ID below and click Connect"})}static renderCallbackUrlSetting(e){new E.Setting(e).setName("OAuth callback URL").setDesc("Use this URL when configuring your Google OAuth application").addText(t=>t.setValue(w).setDisabled(!0)).addButton(t=>t.setButtonText("Copy").onClick(async()=>{await navigator.clipboard.writeText(w),new E.Notice("Callback URL copied to clipboard!")}))}static renderClientIdSetting(e,t,n){new E.Setting(e).setName("Client ID").setDesc("OAuth 2.0 client ID from Google Cloud Console").addText(i=>i.setPlaceholder("123456789-abcdefg.apps.googleusercontent.com").setValue(t).onChange(async s=>{await n(s.trim())}))}static renderTokenExpirySetting(e,t,n){new E.Setting(e).setName("Token Expiry").setDesc("How long before the access token expires and requires re-authentication").addDropdown(i=>{Object.entries(I).forEach(([s,a])=>{i.addOption(s,a)}),i.setValue(t).onChange(async s=>{await n(s)})})}static renderTokenStatus(e,t){let n=l.getTimeRemaining(t),i=l.isTokenExpired(t),s=l.needsRefreshSoon(t),a;t?i?a="\u26A0\uFE0F Token expired":s?a=`\u26A0\uFE0F Token expires in ${n}`:a=`\u2705 Token valid for ${n}`:a="\u2705 Token valid: Unlimited",new E.Setting(e).setName("Token status").setDesc(a)}static renderAccountSetting(e,t,n,i,s,a){let r=new E.Setting(e).setName("Account").setDesc(t?"\u2705 Connected":"\u274C Not Connected");t?(r.addButton(o=>o.setButtonText("Sync calendar").onClick(async()=>{await a()})),r.addButton(o=>o.setWarning().setButtonText("Disconnect").onClick(async()=>{await s()}))):!n||n===""?r.setDesc("\u26A0\uFE0F Please set client ID first"):r.addButton(o=>o.setCta().setButtonText("Connect to Google").onClick(()=>{i()}))}};var U={...O},S=class extends y.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new y.Setting(e).setName("Pick calendar event").setHeading();let t=e.createDiv({cls:"pmc-intro-section"});new y.Setting(t).setName("How to use").setHeading();let n=t.createEl("ul",{cls:"pmc-usage-list"}),i=n.createEl("li");i.appendText("Type "),i.createEl("code",{text:":"}),i.appendText(" in your note to trigger the calendar event picker");let s=n.createEl("li");s.appendText("Type "),s.createEl("code",{text:":meeting"}),s.appendText(" to search and filter events containing 'meeting'"),n.createEl("li").appendText("Select an event from the list to insert it as a link in your note");let r=n.createEl("li");r.appendText("Choose "),r.createEl("strong",{text:"+ Create new event"}),r.appendText(" to create a new calendar event"),new y.Setting(e).setName("Setup & configuration").setHeading(),h.renderSetupGuide(e),h.renderCallbackUrlSetting(e),h.renderClientIdSetting(e,this.plugin.settings.clientId,async o=>{this.plugin.settings.clientId=o,await this.plugin.saveSettings(),this.display()}),h.renderTokenExpirySetting(e,this.plugin.settings.tokenExpiry,async o=>{this.plugin.settings.tokenExpiry=o,this.plugin.settings.tokenExpiryDate=l.calculateExpiryDate(o),await this.plugin.saveSettings(),this.display()}),new y.Setting(e).setName("Suggestion time range").setDesc('Time duration to fetch calendar events for suggestions (e.g., "90 days"). Events from this many days in the past and future will be considered.').addText(o=>o.setPlaceholder("90 days").setValue(String(this.plugin.settings.timeRange)).onChange(async g=>{this.plugin.settings.timeRange=Number(g),await this.plugin.saveSettings()})),this.plugin.settings.accessToken&&h.renderTokenStatus(e,this.plugin.settings.tokenExpiryDate),h.renderAccountSetting(e,!!this.plugin.settings.accessToken,this.plugin.settings.clientId,()=>{f.initiateOAuthFlow(this.plugin.settings.clientId)},async()=>{this.plugin.settings.accessToken="",this.plugin.settings.tokenExpiryDate=void 0,await this.plugin.saveSettings(),this.display(),f.disconnect()},async()=>{await m.syncCalendar(this.plugin.settings.accessToken,this.plugin.settings.tokenExpiryDate)})}};var x=require("obsidian");var P=require("obsidian");var d=require("obsidian");var k=class extends d.Modal{constructor(e,t,n,i){super(e),this.plugin=t,this.initialTitle=n,this.onSubmit=i,this.title=n||"",this.isAllDay=!1,this.description="";let s=new Date;this.date=s.toISOString().split("T")[0]||"";let a=(s.getHours()+1)%24,r=(s.getHours()+2)%24;this.startTime=`${String(a).padStart(2,"0")}:00`,this.endTime=`${String(r).padStart(2,"0")}:00`}onOpen(){let{contentEl:e}=this;e.empty(),new d.Setting(e).setName("Create calendar event").setHeading(),new d.Setting(e).setName("Event title").setDesc("Name of the event").addText(r=>r.setPlaceholder("Team Meeting").setValue(this.title).onChange(o=>{this.title=o})),new d.Setting(e).setName("Date").setDesc("Event date").addText(r=>{r.setPlaceholder("YYYY-MM-DD").setValue(this.date).onChange(o=>{this.date=o}),r.inputEl.type="date"}),new d.Setting(e).setName("All-day event").setDesc("Toggle for all-day events").addToggle(r=>r.setValue(this.isAllDay).onChange(o=>{this.isAllDay=o,e.querySelectorAll(".time-setting").forEach(p=>{o?p.addClass("is-hidden"):p.removeClass("is-hidden")})})),new d.Setting(e).setName("Start time").setDesc("Event start time").addText(r=>{r.setPlaceholder("09:00").setValue(this.startTime).onChange(o=>{this.startTime=o}),r.inputEl.type="time"}).settingEl.addClass("time-setting"),new d.Setting(e).setName("End time").setDesc("Event end time").addText(r=>{r.setPlaceholder("10:00").setValue(this.endTime).onChange(o=>{this.endTime=o}),r.inputEl.type="time"}).settingEl.addClass("time-setting"),new d.Setting(e).setName("Description").setDesc("Additional details (optional)").addTextArea(r=>{r.setPlaceholder("Meeting agenda, notes, etc.").setValue(this.description).onChange(o=>{this.description=o}),r.inputEl.rows=4});let i=e.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),i.createEl("button",{text:"Create event",cls:"mod-cta"}).addEventListener("click",()=>{this.createEvent()})}async createEvent(){if(!this.title.trim()){new d.Notice("\u274C Event title is required");return}if(!this.date){new d.Notice("\u274C Event date is required");return}if(!this.isAllDay&&(!this.startTime||!this.endTime)){new d.Notice("\u274C Start and end times are required");return}if(!this.plugin.settings.accessToken){new d.Notice("\u274C Not authenticated. Please connect your Google account in settings.");return}if(l.isTokenExpired(this.plugin.settings.tokenExpiryDate)){new d.Notice("\u274C Access token has expired. Please reconnect your Google account in settings.");return}try{let e={summary:this.title.trim(),description:this.description.trim()||void 0};if(this.isAllDay)e.start={date:this.date,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},e.end={date:this.date,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};else{let i=`${this.date}T${this.startTime}:00`,s=`${this.date}T${this.endTime}:00`;e.start={dateTime:i,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},e.end={dateTime:s,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone}}let t=await m.createEvent(this.plugin.settings.accessToken,e,"primary",this.plugin.settings.tokenExpiryDate),n=t.htmlLink||`https://calendar.google.com/calendar/event?eid=${encodeURIComponent(t.id)}`;new d.Notice(`\u2705 Event "${this.title}" created successfully!`),this.onSubmit({title:this.title,link:n}),this.close()}catch(e){let t=e instanceof Error?e.message:"Unknown error";new d.Notice(`\u274C Failed to create event: ${t}`)}}onClose(){let{contentEl:e}=this;e.empty()}};var D=class extends P.EditorSuggest{constructor(t,n){super(t);this.cachedEvents=[];this.lastFetchTime=0;this.CACHE_DURATION=5*60*1e3;this.plugin=n}onTrigger(t,n,i){let r=n.getLine(t.line).substring(0,t.ch).match(/:([\w\s]*)$/);if(r){let o=r[1]||"",g=t.ch-r[0].length+1;return{start:{line:t.line,ch:g},end:t,query:o}}return null}async fetchEventsWithCache(t){let n=Date.now();if(n-this.lastFetchTime>this.CACHE_DURATION||this.cachedEvents.length===0)try{let s=new Date(Date.now()-864e5).toISOString(),a=new Date(Date.now()+this.plugin.settings.timeRange*24*60*60*1e3).toISOString();this.cachedEvents=await m.fetchEvents(this.plugin.settings.accessToken,"primary",void 0,s,a,250,this.plugin.settings.tokenExpiryDate),this.lastFetchTime=n}catch(s){return console.error("Error fetching events:",s),[]}return this.cachedEvents}filterEvents(t,n){if(!n||n.trim()==="")return t;let i=n.toLowerCase().trim();return t.filter(s=>{var a,r,o,g;return!!((a=s.summary)!=null&&a.toLowerCase().includes(i)||(r=s.description)!=null&&r.toLowerCase().includes(i)||(o=s.location)!=null&&o.toLowerCase().includes(i)||(g=s.attendees)!=null&&g.some(p=>{var T,v;return((T=p.email)==null?void 0:T.toLowerCase().includes(i))||((v=p.displayName)==null?void 0:v.toLowerCase().includes(i))}))})}async getSuggestions(t){if(this.plugin.settings.accessToken==="")return new P.Notice("Please connect to Google Calendar first"),[];let n=(t.query||"").trim();try{let i=await this.fetchEventsWithCache(),s=this.filterEvents(i,n),a=[];return a.push(...s.map(r=>({event:r,summary:r.summary||r.description||"Untitled Event"}))),[{isCreate:!0,summary:"+ Create new event"},...a]}catch(i){return console.error("Error getting suggestions:",i),[]}}renderSuggestion(t,n){n.empty();let i=n.createDiv({cls:"gcal-suggestion-container"});if(t.isCreate)i.addClass("create-new"),i.createEl("span",{text:t.summary});else if(t.event){let s=t.event,a=i.createDiv({cls:"gcal-suggestion-left"});a.createEl("div",{text:s.summary||"Untitled event",cls:"gcal-event-title"}),s.location&&a.createEl("div",{text:s.location,cls:"gcal-event-location"});let r=i.createDiv({cls:"gcal-suggestion-right"});try{let o=new Date(s.start.dateTime||s.start.date||""),g=new Date,p=o.toDateString()===g.toDateString(),T=o.toDateString()===new Date(g.getTime()+864e5).toDateString(),v="";p?v="Today":T?v="Tomorrow":v=o.toLocaleDateString([],{month:"short",day:"numeric",year:o.getFullYear()!==g.getFullYear()?"numeric":void 0});let A="";s.start.dateTime?A=o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}):A="All day",r.createEl("div",{text:v,cls:"gcal-event-date"}),r.createEl("div",{text:A,cls:"gcal-event-time"}),(s.hangoutLink||s.conferenceData)&&r.createEl("div",{text:"\u{1F3A5} Video",cls:"gcal-event-conference"})}catch(o){console.error("Error formatting date:",o),r.createEl("small",{text:"Invalid date",attr:{style:"color: var(--text-error);"}})}}}selectSuggestion(t,n){if(!this.context){console.error("No context available");return}if(t.isCreate)new k(this.app,this.plugin,this.context.query,i=>{if(this.context){let s=`[${i.title}](${i.link})`;this.context.editor.replaceRange(s,this.context.start,this.context.end)}}).open();else if(t.event){let i=t.event,s=i.htmlLink||`https://calendar.google.com/calendar/event?eid=${encodeURIComponent(i.id)}`,r=`[${i.summary||"Untitled Event"}](${s})`;this.context.editor.replaceRange(r,this.context.start,this.context.end)}}clearCache(){this.cachedEvents=[],this.lastFetchTime=0}};var b=class extends x.Plugin{constructor(){super(...arguments);this.settingTab=null;this.editorSuggestion=null}async onload(){await this.loadSettings(),this.settingTab=new S(this.app,this),this.addSettingTab(this.settingTab),this.registerObsidianProtocolHandler("pick-meeting-token",async t=>{var i;let n=t.access_token;if(n){this.settings.accessToken=n;let s=this.settings.tokenExpiry||"unlimited";this.settings.tokenExpiryDate=l.calculateExpiryDate(s),await this.saveSettings(),(i=this.settingTab)==null||i.display(),new x.Notice("\u2705 Google Calendar Connected!")}else new x.Notice(`\u274C Connection failed: ${t.error||"No token found in response"}`)}),this.editorSuggestion=new D(this.app,this),this.registerEditorSuggest(this.editorSuggestion)}onunload(){}async loadSettings(){this.settings=Object.assign({},U,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
