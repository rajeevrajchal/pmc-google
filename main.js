/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var O=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var $=(p,t)=>{for(var e in t)O(p,e,{get:t[e],enumerable:!0})},H=(p,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of M(t))!U.call(p,i)&&i!==e&&O(p,i,{get:()=>t[i],enumerable:!(n=_(t,i))||n.enumerable});return p};var F=p=>H(O({},"__esModule",{value:!0}),p);var B={};$(B,{default:()=>A});module.exports=F(B);var w=require("obsidian");var N={clientId:"",accessToken:"",tokenExpiry:"unlimited",tokenExpiryDate:void 0,timeRange:90},G={"1week":"1 week","1month":"1 month","3months":"3 months","6months":"6 months",unlimited:"Unlimited (until manually disconnected)"},x="https://rajeevrajchal.github.io/pmc-google/oauth-callback";var k=require("obsidian");var T=class{static initiateOAuthFlow(t){if(!t||t.trim()===""){new k.Notice("Please configure client ID first");return}let e=this.buildAuthUrl(t);new k.Notice("Opening Google authentication..."),window.open(e,"_blank")}static buildAuthUrl(t){let e=new URLSearchParams({client_id:t,redirect_uri:x,response_type:"token",scope:this.SCOPES.join(" "),access_type:"online"});return`${this.OAUTH_URL}?${e.toString()}`}static disconnect(){new k.Notice("Disconnected from Google Calendar")}};T.OAUTH_URL="https://accounts.google.com/o/oauth2/v2/auth",T.SCOPES=["https://www.googleapis.com/auth/calendar.readonly","https://www.googleapis.com/auth/calendar.events"];var l=require("obsidian");var d=class{static calculateExpiryDate(t){if(t==="unlimited")return;let e=Date.now(),n=24*60*60*1e3;switch(t){case"1week":return e+7*n;case"1month":return e+30*n;case"3months":return e+90*n;case"6months":return e+180*n;default:return}}static isTokenExpired(t){return t?Date.now()>=t:!1}static getTimeRemaining(t){if(!t)return"Unlimited";let e=t-Date.now();if(e<=0)return"Expired";let n=Math.floor(e/(24*60*60*1e3)),i=Math.floor(e%(24*60*60*1e3)/(60*60*1e3)),r=Math.floor(e%(60*60*1e3)/(60*1e3));return n>0?`${n} day${n!==1?"s":""}`:i>0?`${i} hour${i!==1?"s":""}`:`${r} minute${r!==1?"s":""}`}static needsRefreshSoon(t){if(!t)return!1;let e=24*60*60*1e3,n=t-Date.now();return n>0&&n<e}static formatExpiryDate(t){return t?new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}};var m=class{static async fetchEvents(t,e="primary",n,i,r,a=250,o){try{if(d.isTokenExpired(o))throw new l.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");let s={singleEvents:"true",orderBy:"startTime",maxResults:a.toString()};i&&(s.timeMin=i),r&&(s.timeMax=r),n&&n.trim()!==""&&(s.q=n);let c=new URLSearchParams(s).toString();return(await(0,l.requestUrl)({url:`${this.BASE_URL}/calendars/${e}/events?${c}`,method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).json.items||[]}catch(s){throw console.error("Error fetching calendar events:",s),new l.Notice("Failed to fetch calendar events"),s}}static async createEvent(t,e,n="primary",i){try{if(d.isTokenExpired(i))throw new l.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");let a=(await(0,l.requestUrl)({url:`${this.BASE_URL}/calendars/${n}/events`,method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)})).json;return new l.Notice("Event created successfully"),a}catch(r){throw console.error("Error creating calendar event:",r),new l.Notice("Failed to create calendar event"),r}}static async updateEvent(t,e,n,i="primary",r){try{if(d.isTokenExpired(r))throw new l.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");let o=(await(0,l.requestUrl)({url:`${this.BASE_URL}/calendars/${i}/events/${e}`,method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)})).json;return new l.Notice("Event updated successfully"),o}catch(a){throw console.error("Error updating calendar event:",a),new l.Notice("Failed to update calendar event"),a}}static async deleteEvent(t,e,n="primary",i){try{if(d.isTokenExpired(i))throw new l.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");await(0,l.requestUrl)({url:`${this.BASE_URL}/calendars/${n}/events/${e}`,method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),new l.Notice("Event deleted successfully")}catch(r){throw console.error("Error deleting calendar event:",r),new l.Notice("Failed to delete calendar event"),r}}static async listCalendars(t,e){try{if(d.isTokenExpired(e))throw new l.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");return(await(0,l.requestUrl)({url:`${this.BASE_URL}/users/me/calendarList`,method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).json.items||[]}catch(n){throw console.error("Error fetching calendars:",n),new l.Notice("Failed to fetch calendars"),n}}static async syncCalendar(t,e){try{if(d.isTokenExpired(e))throw new l.Notice("\u26A0\uFE0F Google Calendar token has expired. Please reconnect in settings."),new Error("Token expired");new l.Notice("Syncing calendar...");let n=new Date().toISOString(),i=new Date(Date.now()+30*24*60*60*1e3).toISOString(),r=await this.fetchEvents(t,"primary",void 0,n,i);new l.Notice(`Synced ${r.length} events`);return}catch(n){throw console.error("Error syncing calendar:",n),new l.Notice("Failed to sync calendar"),n}}};m.BASE_URL="https://www.googleapis.com/calendar/v3";var E=require("obsidian");var h=class{static renderSetupGuide(t){let e=t.createDiv({cls:"pmc-setup-guide"});new E.Setting(e).setName("Setup guide").setHeading();let n=e.createEl("ol"),i=n.createEl("li");i.createEl("strong",{text:"Create a google cloud project:"});let r=i.createEl("ul"),a=r.createEl("li");a.appendText("Go to "),a.createEl("a",{text:"Google Cloud Console",href:"https://console.cloud.google.com/",attr:{target:"_blank"}}),r.createEl("li",{text:'Click "Select a project" \u2192 "New project"'}),r.createEl("li",{text:'Give it a name (e.g., "Obsidian PMC plugin") and click "Create"'});let o=n.createEl("li");o.createEl("strong",{text:"Enable Google Calendar API:"});let s=o.createEl("ul");s.createEl("li",{text:'In the sidebar, go to "APIs & services" \u2192 "Library"'}),s.createEl("li",{text:'Search for "Google Calendar API"'}),s.createEl("li",{text:'Click on it and press "Enable"'});let c=n.createEl("li");c.createEl("strong",{text:"Create OAuth 2.0 credentials:"});let u=c.createEl("ul");u.createEl("li",{text:'Go to "APIs & services" \u2192 "Credentials"'}),u.createEl("li",{text:'Click "Create credentials" \u2192 "OAuth client ID"'}),u.createEl("li",{text:"If prompted, configure the OAuth consent screen first"}),u.createEl("li",{text:'Select "Web application" as the application type'}),u.createEl("li",{text:"Add this authorized redirect URI: "}).createEl("code",{text:x}),u.createEl("li",{text:'Click "Create" and copy your client ID'}),n.createEl("li").createEl("strong",{text:"Paste the client ID below and click Connect"})}static renderCallbackUrlSetting(t){new E.Setting(t).setName("OAuth callback URL").setDesc("Use this URL when configuring your Google OAuth application").addText(e=>e.setValue(x).setDisabled(!0)).addButton(e=>e.setButtonText("Copy").onClick(async()=>{await navigator.clipboard.writeText(x),new E.Notice("Callback URL copied to clipboard!")}))}static async renderClientIdSetting(t,e,n){new E.Setting(t).setName("Client ID").setDesc("OAuth 2.0 client ID from Google Cloud Console (stored encrypted)").addText(i=>i.setPlaceholder("123456789-abcdefg.apps.googleusercontent.com").setValue(e).onChange(async r=>{let a=r.trim();await n(a)}))}static renderTokenExpirySetting(t,e,n){new E.Setting(t).setName("Token Expiry").setDesc("How long before the access token expires and requires re-authentication").addDropdown(i=>{Object.entries(G).forEach(([r,a])=>{i.addOption(r,a)}),i.setValue(e).onChange(async r=>{await n(r)})})}static renderTokenStatus(t,e){let n=d.getTimeRemaining(e),i=d.isTokenExpired(e),r=d.needsRefreshSoon(e),a;e?i?a="\u26A0\uFE0F Token expired":r?a=`\u26A0\uFE0F Token expires in ${n}`:a=`\u2705 Token valid for ${n}`:a="\u2705 Token valid: Unlimited",new E.Setting(t).setName("Token status").setDesc(a)}static renderAccountSetting(t,e,n,i,r,a){let o=new E.Setting(t).setName("Account").setDesc(e?"\u2705 Connected":"\u274C Not Connected");e?(o.addButton(s=>s.setButtonText("Sync calendar").onClick(async()=>{await a()})),o.addButton(s=>s.setWarning().setButtonText("Disconnect").onClick(async()=>{await r()}))):!n||n===""?o.setDesc("\u26A0\uFE0F Please set client ID first"):o.addButton(s=>s.setCta().setButtonText("Connect to Google").onClick(()=>{i(n)}))}};var R={...N},P=class extends w.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new w.Setting(t).setName("Pick calendar event").setHeading();let e=t.createDiv({cls:"pmc-intro-section"});new w.Setting(e).setName("How to use").setHeading();let n=e.createEl("ul",{cls:"pmc-usage-list"}),i=n.createEl("li");i.appendText("Type "),i.createEl("code",{text:":"}),i.appendText(" in your note to trigger the calendar event picker");let r=n.createEl("li");r.appendText("Type "),r.createEl("code",{text:":meeting"}),r.appendText(" to search and filter events containing 'meeting'"),n.createEl("li").appendText("Select an event from the list to insert it as a link in your note");let o=n.createEl("li");o.appendText("Choose "),o.createEl("strong",{text:"+ Create new event"}),o.appendText(" to create a new calendar event"),new w.Setting(t).setName("Setup & configuration").setHeading(),h.renderSetupGuide(t),h.renderCallbackUrlSetting(t),h.renderClientIdSetting(t,this.plugin.settings.clientId,async s=>{this.plugin.settings.clientId=s,await this.plugin.saveSettings(),this.display()}).catch(s=>{console.error("Failed to render client ID setting:",s)}),h.renderTokenExpirySetting(t,this.plugin.settings.tokenExpiry,async s=>{this.plugin.settings.tokenExpiry=s,this.plugin.settings.tokenExpiryDate=d.calculateExpiryDate(s),await this.plugin.saveSettings(),this.display()}),new w.Setting(t).setName("Suggestion time range").setDesc('Time duration to fetch calendar events for suggestions (e.g., "90 days"). Events from this many days in the past and future will be considered.').addText(s=>s.setPlaceholder("90 days").setValue(String(this.plugin.settings.timeRange)).onChange(async c=>{this.plugin.settings.timeRange=Number(c),await this.plugin.saveSettings()})),this.plugin.settings.accessToken&&h.renderTokenStatus(t,this.plugin.settings.tokenExpiryDate),h.renderAccountSetting(t,!!this.plugin.settings.accessToken,this.plugin.settings.clientId,s=>{T.initiateOAuthFlow(s)},async()=>{this.plugin.settings.accessToken="",this.plugin.settings.tokenExpiryDate=void 0,await this.plugin.saveSettings(),this.display(),T.disconnect()},async()=>{await m.syncCalendar(this.plugin.settings.accessToken,this.plugin.settings.tokenExpiryDate)})}};var S=require("obsidian");var L=require("obsidian");var y=class{static async deriveKey(t,e){let n=new TextEncoder,i=await crypto.subtle.importKey("raw",n.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},i,{name:this.ALGORITHM,length:this.KEY_LENGTH},!1,["encrypt","decrypt"])}static getVaultPassphrase(){return`${window.location.pathname||"obsidian-vault"}-pmc-plugin-secret-v1`}static async encrypt(t){if(!t)return"";try{let e=crypto.getRandomValues(new Uint8Array(this.SALT_LENGTH)),n=crypto.getRandomValues(new Uint8Array(this.IV_LENGTH)),i=this.getVaultPassphrase(),r=await this.deriveKey(i,e),o=new TextEncoder().encode(t),s=await crypto.subtle.encrypt({name:this.ALGORITHM,iv:n},r,o),c=new Uint8Array(e.length+n.length+s.byteLength);return c.set(e,0),c.set(n,e.length),c.set(new Uint8Array(s),e.length+n.length),this.arrayBufferToBase64(c)}catch(e){throw console.error("Encryption error:",e),new Error("Failed to encrypt data")}}static async decrypt(t){if(!t)return"";try{let e=this.base64ToArrayBuffer(t),n=e.slice(0,this.SALT_LENGTH),i=e.slice(this.SALT_LENGTH,this.SALT_LENGTH+this.IV_LENGTH),r=e.slice(this.SALT_LENGTH+this.IV_LENGTH),a=this.getVaultPassphrase(),o=await this.deriveKey(a,n),s=await crypto.subtle.decrypt({name:this.ALGORITHM,iv:i},o,r);return new TextDecoder().decode(s)}catch(e){throw console.error("Decryption error:",e),new Error("Failed to decrypt data")}}static arrayBufferToBase64(t){let e="",n=t.byteLength;for(let i=0;i<n;i++){let r=t[i];r!==void 0&&(e+=String.fromCharCode(r))}return btoa(e)}static base64ToArrayBuffer(t){let e=atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i}static isEncrypted(t){if(!t)return!1;let e=Math.ceil((this.SALT_LENGTH+this.IV_LENGTH+16)*4/3),n=/^[A-Za-z0-9+/]+=*$/;return t.length>=e&&n.test(t)}};y.ALGORITHM="AES-GCM",y.KEY_LENGTH=256,y.IV_LENGTH=12,y.SALT_LENGTH=16;var g=require("obsidian");var D=class extends g.Modal{constructor(t,e,n,i){super(t),this.plugin=e,this.initialTitle=n,this.onSubmit=i,this.title=n||"",this.isAllDay=!1,this.description="";let r=new Date;this.date=r.toISOString().split("T")[0]||"";let a=(r.getHours()+1)%24,o=(r.getHours()+2)%24;this.startTime=`${String(a).padStart(2,"0")}:00`,this.endTime=`${String(o).padStart(2,"0")}:00`}onOpen(){let{contentEl:t}=this;t.empty(),new g.Setting(t).setName("Create calendar event").setHeading(),new g.Setting(t).setName("Event title").setDesc("Name of the event").addText(o=>o.setPlaceholder("Team Meeting").setValue(this.title).onChange(s=>{this.title=s})),new g.Setting(t).setName("Date").setDesc("Event date").addText(o=>{o.setPlaceholder("YYYY-MM-DD").setValue(this.date).onChange(s=>{this.date=s}),o.inputEl.type="date"}),new g.Setting(t).setName("All-day event").setDesc("Toggle for all-day events").addToggle(o=>o.setValue(this.isAllDay).onChange(s=>{this.isAllDay=s,t.querySelectorAll(".time-setting").forEach(u=>{s?u.addClass("is-hidden"):u.removeClass("is-hidden")})})),new g.Setting(t).setName("Start time").setDesc("Event start time").addText(o=>{o.setPlaceholder("09:00").setValue(this.startTime).onChange(s=>{this.startTime=s}),o.inputEl.type="time"}).settingEl.addClass("time-setting"),new g.Setting(t).setName("End time").setDesc("Event end time").addText(o=>{o.setPlaceholder("10:00").setValue(this.endTime).onChange(s=>{this.endTime=s}),o.inputEl.type="time"}).settingEl.addClass("time-setting"),new g.Setting(t).setName("Description").setDesc("Additional details (optional)").addTextArea(o=>{o.setPlaceholder("Meeting agenda, notes, etc.").setValue(this.description).onChange(s=>{this.description=s}),o.inputEl.rows=4});let i=t.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),i.createEl("button",{text:"Create event",cls:"mod-cta"}).addEventListener("click",()=>{this.createEvent()})}async createEvent(){if(!this.title.trim()){new g.Notice("\u274C Event title is required");return}if(!this.date){new g.Notice("\u274C Event date is required");return}if(!this.isAllDay&&(!this.startTime||!this.endTime)){new g.Notice("\u274C Start and end times are required");return}if(!this.plugin.settings.accessToken){new g.Notice("\u274C Not authenticated. Please connect your Google account in settings.");return}if(d.isTokenExpired(this.plugin.settings.tokenExpiryDate)){new g.Notice("\u274C Access token has expired. Please reconnect your Google account in settings.");return}try{let t={summary:this.title.trim(),description:this.description.trim()||void 0};if(this.isAllDay)t.start={date:this.date,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},t.end={date:this.date,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};else{let i=`${this.date}T${this.startTime}:00`,r=`${this.date}T${this.endTime}:00`;t.start={dateTime:i,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},t.end={dateTime:r,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone}}let e=await m.createEvent(this.plugin.settings.accessToken,t,"primary",this.plugin.settings.tokenExpiryDate),n=e.htmlLink||`https://calendar.google.com/calendar/event?eid=${encodeURIComponent(e.id)}`;new g.Notice(`\u2705 Event "${this.title}" created successfully!`),this.onSubmit({title:this.title,link:n}),this.close()}catch(t){let e=t instanceof Error?t.message:"Unknown error";new g.Notice(`\u274C Failed to create event: ${e}`)}}onClose(){let{contentEl:t}=this;t.empty()}};var b=class extends L.EditorSuggest{constructor(e,n){super(e);this.cachedEvents=[];this.lastFetchTime=0;this.CACHE_DURATION=5*60*1e3;this.plugin=n}onTrigger(e,n,i){let o=n.getLine(e.line).substring(0,e.ch).match(/:([\w\s]*)$/);if(o){let s=o[1]||"",c=e.ch-o[0].length+1;return{start:{line:e.line,ch:c},end:e,query:s}}return null}async fetchEventsWithCache(e){let n=Date.now();if(n-this.lastFetchTime>this.CACHE_DURATION||this.cachedEvents.length===0)try{let r=new Date(Date.now()-864e5).toISOString(),a=new Date(Date.now()+this.plugin.settings.timeRange*24*60*60*1e3).toISOString();this.cachedEvents=await m.fetchEvents(this.plugin.settings.accessToken,"primary",void 0,r,a,250,this.plugin.settings.tokenExpiryDate),this.lastFetchTime=n}catch(r){return console.error("Error fetching events:",r),[]}return this.cachedEvents}filterEvents(e,n){if(!n||n.trim()==="")return e;let i=n.toLowerCase().trim();return e.filter(r=>{var a,o,s,c;return!!((a=r.summary)!=null&&a.toLowerCase().includes(i)||(o=r.description)!=null&&o.toLowerCase().includes(i)||(s=r.location)!=null&&s.toLowerCase().includes(i)||(c=r.attendees)!=null&&c.some(u=>{var C,v;return((C=u.email)==null?void 0:C.toLowerCase().includes(i))||((v=u.displayName)==null?void 0:v.toLowerCase().includes(i))}))})}async getSuggestions(e){if(this.plugin.settings.accessToken==="")return new L.Notice("Please connect to Google Calendar first"),[];let n=(e.query||"").trim();try{let i=await this.fetchEventsWithCache(),r=this.filterEvents(i,n),a=[];return a.push(...r.map(o=>({event:o,summary:o.summary||o.description||"Untitled Event"}))),[{isCreate:!0,summary:"+ Create new event"},...a]}catch(i){return console.error("Error getting suggestions:",i),[]}}renderSuggestion(e,n){n.empty();let i=n.createDiv({cls:"gcal-suggestion-container"});if(e.isCreate)i.addClass("create-new"),i.createEl("span",{text:e.summary});else if(e.event){let r=e.event,a=i.createDiv({cls:"gcal-suggestion-left"});a.createEl("div",{text:r.summary||"Untitled event",cls:"gcal-event-title"}),r.location&&a.createEl("div",{text:r.location,cls:"gcal-event-location"});let o=i.createDiv({cls:"gcal-suggestion-right"});try{let s=new Date(r.start.dateTime||r.start.date||""),c=new Date,u=s.toDateString()===c.toDateString(),C=s.toDateString()===new Date(c.getTime()+864e5).toDateString(),v="";u?v="Today":C?v="Tomorrow":v=s.toLocaleDateString([],{month:"short",day:"numeric",year:s.getFullYear()!==c.getFullYear()?"numeric":void 0});let I="";r.start.dateTime?I=s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}):I="All day",o.createEl("div",{text:v,cls:"gcal-event-date"}),o.createEl("div",{text:I,cls:"gcal-event-time"}),(r.hangoutLink||r.conferenceData)&&o.createEl("div",{text:"\u{1F3A5} Video",cls:"gcal-event-conference"})}catch(s){console.error("Error formatting date:",s),o.createEl("small",{text:"Invalid date",attr:{style:"color: var(--text-error);"}})}}}selectSuggestion(e,n){if(!this.context){console.error("No context available");return}if(e.isCreate){let i=this.context.editor,r={...this.context.start},a={...this.context.end},o=this.context.query;new D(this.app,this.plugin,o,s=>{let c=`[${s.title}](${s.link})`;i.replaceRange(c,r,a),this.clearCache()}).open()}else if(e.event){let i=e.event,r=i.htmlLink||`https://calendar.google.com/calendar/event?eid=${encodeURIComponent(i.id)}`,o=`[${i.summary||"Untitled Event"}](${r})`;this.context.editor.replaceRange(o,this.context.start,this.context.end)}}clearCache(){this.cachedEvents=[],this.lastFetchTime=0}};var f=class{static async encryptSettings(t){let e={...t};for(let n of this.ENCRYPTED_FIELDS){let i=e[n];if(i&&typeof i=="string"&&i.length>0&&!this.isEncrypted(i))try{let r=await y.encrypt(i);e[n]=this.ENCRYPTION_PREFIX+r}catch(r){console.error(`Failed to encrypt field ${String(n)}:`,r)}}return e}static async decryptSettings(t){let e={...t};for(let n of this.ENCRYPTED_FIELDS){let i=e[n];if(i&&typeof i=="string"&&this.isEncrypted(i))try{let r=i.substring(this.ENCRYPTION_PREFIX.length),a=await y.decrypt(r);e[n]=a}catch(r){console.error(`Failed to decrypt field ${String(n)}:`,r),e[n]=""}}return e}static isEncrypted(t){return t.startsWith(this.ENCRYPTION_PREFIX)}static async migrateToEncrypted(t){let e=!1;for(let n of this.ENCRYPTED_FIELDS){let i=t[n];if(i&&typeof i=="string"&&i.length>0&&!this.isEncrypted(i)){e=!0;break}}return e?(console.log("Migrating settings to encrypted format..."),{settings:await this.encryptSettings(t),migrated:!0}):{settings:t,migrated:!1}}};f.ENCRYPTED_FIELDS=["clientId","accessToken"],f.ENCRYPTION_PREFIX="enc:";var A=class extends S.Plugin{constructor(){super(...arguments);this.settingTab=null;this.editorSuggestion=null}async onload(){await this.loadSettings(),this.settingTab=new P(this.app,this),this.addSettingTab(this.settingTab),this.registerObsidianProtocolHandler("pick-meeting-token",async e=>{var i;let n=e.access_token;if(n)try{this.settings.accessToken=n;let r=this.settings.tokenExpiry||"unlimited";this.settings.tokenExpiryDate=d.calculateExpiryDate(r),await this.saveSettings(),(i=this.settingTab)==null||i.display(),new S.Notice("\u2705 Google Calendar Connected!")}catch(r){console.error("Failed to save access token:",r),new S.Notice("\u274C Failed to secure access token")}else new S.Notice(`\u274C Connection failed: ${e.error||"No token found in response"}`)}),this.editorSuggestion=new b(this.app,this),this.registerEditorSuggest(this.editorSuggestion)}onunload(){}async loadSettings(){let e=await this.loadData(),n=Object.assign({},R,e);this.settings=await f.decryptSettings(n);let{settings:i,migrated:r}=await f.migrateToEncrypted(this.settings);r&&(this.settings=i,await this.saveSettings(),new S.Notice("Settings have been encrypted for enhanced security"))}async saveSettings(){let e=await f.encryptSettings(this.settings);await this.saveData(e)}};
